<!DOCTYPE html>
<html>
<head>
    <title>LLM Text Generator</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #output {
            background: #111;
            color: #0f0;
            padding: 10px;
            white-space: pre-wrap;
            height: 300px;
            overflow-y: auto;
            border-radius: 6px;
        }
        button { margin-top: 10px; }
    </style>
</head>
<body>

<h2>Text Generator</h2>

<label>Model:</label>
<select id="model">
    <option value="gpt2-large">GPT-2 0.7B</option>
    <option value="opt-1b">OPT 1.3B</option>
    <option value="phi-1b">Phi 1.3B</option>
    <option value="bloom-1b">Bloom 1.7B</option>
</select>
<br><br>

<label>Number of tokens:</label>
<input type="number" id="num_tokens" value="32">
<br><br>

<label>Prompt:</label><br>
<textarea id="text" rows="4" cols="50"></textarea>
<br><br>

<button onclick="runStream()">Run</button>
<button onclick="stopStream()">Stop</button>

<h3>Output:</h3>
<pre id="output"></pre>

<script>
let controller = null;

async function runStream() {
    const output = document.getElementById("output");
    output.textContent = "";

    // Abort controller for stopping streaming
    controller = new AbortController();

    const payload = {
        model: document.getElementById("model").value,
        num_tokens: parseInt(document.getElementById("num_tokens").value),
        text: document.getElementById("text").value
    };

    const response = await fetch("https://pim-llm.korea-commit.workers.dev/", {
        method: "POST",
        body: JSON.stringify(payload),
        signal: controller.signal
    });

    const reader = response.body.getReader();
    const decoder = new TextDecoder();

    while (true) {
        const { value, done } = await reader.read();
        if (done) break;

        const chunk = decoder.decode(value);
        output.textContent += chunk;

        output.scrollTop = output.scrollHeight; // Auto-scroll
    }
}

function stopStream() {
    if (controller) controller.abort();
}
</script>
</body>
</html>
